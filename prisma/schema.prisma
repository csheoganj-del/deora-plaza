// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  username     String   @unique
  password     String
  role         String   // super_admin, owner, cafe_manager, waiter, kitchen, etc.
  businessUnit String   // cafe, bar, hotel, garden, all
  profile      String   // JSON string for name, mobile, etc.
  permissions  String   // JSON string or comma-separated list
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  lastLogin    DateTime?
}

model Customer {
  id              String   @id @default(uuid())
  mobileNumber    String   @unique
  name            String
  email           String?
  visitCount      Int      @default(0)
  totalSpent      Float    @default(0.0)
  discountTier    String   @default("none") // none, bronze, silver, gold
  lastVisit       DateTime @default(now())
  preferredBusiness String?
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  orders          Order[]
  bookings        Booking[]
}

model Table {
  id            String   @id @default(uuid())
  tableNumber   String
  businessUnit  String
  capacity      Int
  status        String   @default("available") // available, occupied, reserved
  currentOrderId String?
  customerCount Int      @default(0)
  assignedWaiterId String?
  bookingDetails String? // JSON string
  lastUpdated   DateTime @updatedAt
  orders        Order[]
}

model Order {
  id              String      @id @default(uuid())
  orderNumber     String      @unique
  type            String      // dine-in, takeaway, bar-order, hotel-order
  businessUnit    String
  tableId         String?
  table           Table?      @relation(fields: [tableId], references: [id])
  customerMobile  String?
  customer        Customer?   @relation(fields: [customerMobile], references: [mobileNumber])
  status          String      @default("pending") // pending, preparing, ready, served, billed
  staffId         String
  totalAmount     Float       @default(0.0)
  items           OrderItem[]
  bill            Bill?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model OrderItem {
  id                  String  @id @default(uuid())
  orderId             String
  order               Order   @relation(fields: [orderId], references: [id])
  menuItemId          String
  name                String
  price               Float
  quantity            Int
  specialInstructions String?
  total               Float
}

model Bill {
  id              String   @id @default(uuid())
  billNumber      String   @unique
  orderId         String   @unique
  order           Order    @relation(fields: [orderId], references: [id])
  businessUnit    String
  subtotal        Float
  gstPercentage   Float    @default(5.0)
  gstAmount       Float
  autoDiscount    Float    @default(0.0)
  manualDiscount  Float    @default(0.0)
  grandTotal      Float
  paymentMethod   String?  // cash, upi, card (nullable until paid)
  paymentStatus   String   @default("pending") // pending, paid, failed
  amountPaid      Float    @default(0.0)
  change          Float    @default(0.0)
  createdAt       DateTime @default(now())
}

model MenuItem {
  id          String   @id @default(uuid())
  name        String
  description String?
  price       Float
  category    String
  businessUnit String
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PartnershipSettlement {
  id              String   @id @default(uuid())
  businessUnit    String
  month           String   // YYYY-MM
  totalRevenue    Float
  ownerPercentage Float    @default(40.0)
  ownerShare      Float
  managerShare    Float
  status          String   @default("pending") // pending, completed
  settlementDate  DateTime?
  createdAt       DateTime @default(now())
}

model InventoryItem {
  id           String   @id @default(uuid())
  name         String
  quantity     Float
  unit         String   // kg, ltr, pcs
  minThreshold Float    @default(5.0)
  businessUnit String
  lastUpdated  DateTime @updatedAt
}

model Room {
  id            String    @id @default(uuid())
  roomNumber    String    @unique
  type          String    // Single, Double, Suite
  pricePerNight Float
  status        String    @default("available") // available, occupied, cleaning, maintenance
  bookings      Booking[]
}

model Booking {
  id             String   @id @default(uuid())
  customerMobile String
  customer       Customer @relation(fields: [customerMobile], references: [mobileNumber])
  type           String   // hotel, garden
  startDate      DateTime
  endDate        DateTime
  status         String   @default("confirmed") // confirmed, checked_in, checked_out, cancelled, completed
  totalAmount    Float
  notes          String?
  roomId         String?
  room           Room?    @relation(fields: [roomId], references: [id])
  
  // Garden Event specific fields
  eventType      String?  // wedding, reception, birthday, corporate, etc.
  guestCount     Int?
  eventTime      String?  // morning, afternoon, evening, full-day
  advancePayment Float    @default(0.0)
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
